<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>VariousImp ê²Œì‹œíŒ</title>
    <style>
        body { font-family: sans-serif; margin: 40px; background: #f8f9fa; }
        h1, h2 { color: #333; }
        input, textarea { width: 100%; padding: 10px; margin: 6px 0; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; margin-top: 10px; border: none; background-color: #007bff; color: white; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .post { border: 1px solid #ddd; background: white; padding: 10px; margin-top: 10px; border-radius: 4px; }
        .form-container { margin-top: 30px; background: #fff; padding: 20px; border-radius: 6px; border: 1px solid #ddd; }
    </style>
</head>
<body>
<h1>VariousImp ê²Œì‹œíŒ</h1>

<div>
    <h2>ğŸ” ê²Œì‹œê¸€ ê²€ìƒ‰</h2>
    <input type="text" id="searchKeyword" placeholder="ì œëª© í‚¤ì›Œë“œ ì…ë ¥" />
    <button onclick="searchPosts()">ê²€ìƒ‰</button>
</div>

<div>
    <h2>ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡</h2>
    <div id="post-list"></div>
    <button onclick="prevPage()">ì´ì „</button>
    <span id="page-info"></span>
    <button onclick="nextPage()">ë‹¤ìŒ</button>
</div>

<div class="form-container">
    <h2>âœ ê²Œì‹œê¸€ ì‘ì„±</h2>
    <input type="text" id="title" placeholder="ì œëª©" />
    <textarea id="content" placeholder="ë‚´ìš©"></textarea>
    <input type="text" id="author" placeholder="ì‘ì„±ì" />
    <button onclick="createPost()">ì‘ì„±</button>
</div>

<script>
    let currentPage = 1;
    const size = 5;

    function loadPosts() {
        fetch(`/posts?page=${currentPage}&size=${size}`)
            .then(res => res.json())
            .then(data => {
                const postList = data.content.map(p =>
                    `<div class="post">
                            <h3>${p.title}</h3>
                            <p><strong>ì‘ì„±ì:</strong> ${p.author}</p>
                            <button onclick="viewPost(${p.id})">ë³´ê¸°</button>
                            <button onclick="deletePost(${p.id})">ì‚­ì œ</button>
                        </div>`
                ).join('');
                document.getElementById("post-list").innerHTML = postList;
                document.getElementById("page-info").innerText = `${currentPage} / ${data.totalPages}`;
            });
    }

    function createPost() {
        const title = document.getElementById("title").value;
        const content = document.getElementById("content").value;
        const author = document.getElementById("author").value;
        fetch('/posts', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, content, author })
        }).then(() => {
            alert("ì‘ì„± ì™„ë£Œ!");
            loadPosts();
        });
    }

    function viewPost(id) {
        window.location.href = `/view.html?id=${id}`;
    }

    function deletePost(id) {
        fetch(`/posts/${id}`, {
            method: 'DELETE'
        }).then(() => {
            alert("ì‚­ì œ ì™„ë£Œ!");
            loadPosts();
        });
    }

    function searchPosts() {
        const keyword = document.getElementById("searchKeyword").value;
        fetch(`/posts/search?keyword=${encodeURIComponent(keyword)}&page=1&size=5`)
            .then(res => res.json())
            .then(data => {
                const results = data.titles.map(t =>
                    `<div class="post"><p>${t}</p></div>`
                ).join('');
                document.getElementById("post-list").innerHTML = results;
                document.getElementById("page-info").innerText = `ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€: ${data.currentPage} / ${data.totalPages}`;
            });
    }

    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            loadPosts();
        }
    }

    function nextPage() {
        currentPage++;
        loadPosts();
    }

    loadPosts();
</script>
</body>
</html>
